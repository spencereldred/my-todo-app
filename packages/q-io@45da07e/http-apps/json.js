var Q=require("q"),Content=require("./content"),Status=require("./status");exports.HandleJsonResponses=function(e,t,n){return function(i){return i.handleJsonResponse=exports.handleJsonResponse,Q.fcall(e,i).then(function(e){return void 0!==e.data?Q.fcall(exports.handleJsonResponse,e,t,n):e})}},exports.handleJsonResponse=function(e,t,n){return e.headers["content-type"]="application/json",e.body={forEach:function(i){i(JSON.stringify(e.data,t,n))}},e},exports.Json=function(e,t,n){return function(i,r){return Q.when(e(i,r),function(e){return exports.json(e,t,n)})}},exports.json=function(e,t,n){try{var i=JSON.stringify(e,t,n)}catch(r){return Q.reject(r)}return Content.ok([i])},exports.JsonRequest=function(e,t){return t||(t=Status.badRequest),Content.ContentRequest(function(n,i,r){try{var a=JSON.parse(n)}catch(s){return t(i,s)}return e(a,i,r)})};